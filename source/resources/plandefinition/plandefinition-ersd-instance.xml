<?xml version="1.0" encoding="UTF-8"?>
<PlanDefinition
    xmlns="http://hl7.org/fhir">
    <id value="plandefinition-ersd-instance"/>
    <meta>
        <versionId value="35"/>
        <lastUpdated value="2019-10-05T03:15:42.000-04:00"/>
        <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/ersd-plandefinition"/>
    </meta>
    <text>
        <status value="generated"/>
        <div
            xmlns="http://www.w3.org/1999/xhtml">
            <table
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
                <tr>
                    <td style="font-weight: bold">id:
            </td>
                    <td>
                        <span title="id">plandefinition-ersd-instance</span>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">meta:
            </td>
                    <td>
                        <ul style="list-style:none; padding-left:0; margin:0 0;">
                            <li>
                                <span title="versionId">33</span>
                            </li>
                            <li>
                                <span title="lastUpdated">2019-10-03T03:43:26.000-04:00</span>
                            </li>
                            <li>
                                <span title="profile">http://hl7.org/fhir/us/ecr/StructureDefinition/ersd-plandefinition</span>
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">url:
            </td>
                    <td>
                        <span title="url">http://hl7.org/fhir/us/ecr/PlanDefinition/plandefinition-ersd-instance</span>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">version:
            </td>
                    <td>
                        <span title="version">0.1</span>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">name:
            </td>
                    <td>
                        <span title="name">PlanDefinition_eRSD_Instance</span>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">title:
            </td>
                    <td>
                        <span title="title">eRSD PlanDefinition Instance</span>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">type:
            </td>
                    <td>
                        <ul style="list-style:none; padding-left:0; margin:0 0;">
                            <li>
                                <span title="display">ECA Rule</span>  (
                                <span title="code">eca-rule</span> )
          
                            </li>
                            <li>
                                <span title="system">
                                    <a href="http://terminology.hl7.org/CodeSystem/plan-definition-type">http://terminology.hl7.org/CodeSystem/plan-definition-type</a>
                                </span>
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">status:
            </td>
                    <td>
                        <span title="status">active</span>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">date:
            </td>
                    <td>
                        <span title="date">2019-09-15T12:49:11-04:00</span>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">action:
            </td>
                    <td>
                        <table>
                            <tr>
                                <td style="font-weight: bold">description:
            </td>
                                <td>
                                    <span title="description">
                                        <p>This action represents the matching of a trigger code to one of the values in the eRSD value sets.</p>
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">textEquivalent:
            </td>
                                <td>
                                    <span title="textEquivalent">Match of a code to one of the values in the eRSD value sets.</span>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">trigger:
            </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>
                                            <span title="type">named-event</span>
                                        </li>
                                        <li>
                                            <span title="name">match-trigger-diagnosis</span>
                                        </li>
                                        <li>
                                            <span title="type">CodeableConcept</span>
                                        </li>
                                        <li>
                                            <span title="path">Condition.code</span>
                                        </li>
                                        <li>
                                            <span title="valueSet">http://hl7.org/fhir/us/ecr/ValueSet/valueset-dxtc-example</span>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">trigger:
            </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>
                                            <span title="type">named-event</span>
                                        </li>
                                        <li>
                                            <span title="name">match-trigger-immunization</span>
                                        </li>
                                        <li>
                                            <span title="type">CodeableConcept</span>
                                        </li>
                                        <li>
                                            <span title="path">Immunization.vaccineCode</span>
                                        </li>
                                        <li>
                                            <span title="valueSet">http://hl7.org/fhir/us/ecr/ValueSet/valueset-iztc-example</span>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">trigger:
            </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>
                                            <span title="type">named-event</span>
                                        </li>
                                        <li>
                                            <span title="name">match-trigger-lab-order</span>
                                        </li>
                                        <li>
                                            <span title="type">CodeableConcept</span>
                                        </li>
                                        <li>
                                            <span title="path">ServiceReqeust.code</span>
                                        </li>
                                        <li>
                                            <span title="valueSet">http://hl7.org/fhir/us/ecr/ValueSet/valueset-lotc-example</span>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">trigger:
            </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>
                                            <span title="type">named-event</span>
                                        </li>
                                        <li>
                                            <span title="name">match-trigger-lab-observation</span>
                                        </li>
                                        <li>
                                            <span title="type">CodeableConcept</span>
                                        </li>
                                        <li>
                                            <span title="path">Observation.code</span>
                                        </li>
                                        <li>
                                            <span title="valueSet">http://hl7.org/fhir/us/ecr/ValueSet/valueset-lrtc-example</span>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">trigger:
            </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>
                                            <span title="type">named-event</span>
                                        </li>
                                        <li>
                                            <span title="name">match-trigger-medication</span>
                                        </li>
                                        <li>
                                            <span title="type">CodeableConcept</span>
                                        </li>
                                        <li>
                                            <span title="path">MedicationAdministration.medicationCodeableConcept</span>
                                        </li>
                                        <li>
                                            <span title="valueSet">http://hl7.org/fhir/us/ecr/ValueSet/valueset-mrtc-example</span>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">trigger:
            </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>
                                            <span title="type">named-event</span>
                                        </li>
                                        <li>
                                            <span title="name">match-trigger-organism-substance</span>
                                        </li>
                                        <li>
                                            <span title="type">CodeableConcept</span>
                                        </li>
                                        <li>
                                            <span title="path">Observation.code</span>
                                        </li>
                                        <li>
                                            <span title="valueSet">http://hl7.org/fhir/us/ecr/ValueSet/valueset-ostc-example</span>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">action:
            </td>
                    <td>
                        <table>
                            <tr>
                                <td style="font-weight: bold">description:
            </td>
                                <td>
                                    <span title="description">
                                        <p>This action represents the initial creation of the eICR.</p>
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">textEquivalent:
            </td>
                                <td>
                                    <span title="textEquivalent">eICR construction delay (x hours) - time after trigger event before an eICR should be created.</span>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">relatedAction:
            </td>
                                <td>
                                    <table>
                                        <tr>
                                            <td style="font-weight: bold">actionId:
            </td>
                                            <td>
                                                <span title="actionId">match-trigger</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold">relationship:
            </td>
                                            <td>
                                                <span title="relationship">after</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold">offsetDuration:
            </td>
                                            <td>
                                                <ul style="list-style:none; padding-left:0; margin:0 0;">
                                                    <li>
                                                        <span title="value">3</span>
                                                    </li>
                                                    <li>
                                                        <span title="unit">h</span>
                                                    </li>
                                                </ul>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">action:
            </td>
                    <td>
                        <table>
                            <tr>
                                <td style="font-weight: bold">description:
            </td>
                                <td>
                                    <span title="description">
                                        <p>This action represents the periodic update of the eICR.</p>
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">textEquivalent:
            </td>
                                <td>
                                    <span title="textEquivalent">eICR periodic update (y hours) – the time after an initial eICR transmission to send a new eICR as an update during long encounters.</span>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">trigger:
            </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>
                                            <span title="type">periodic</span>
                                        </li>
                                        <li>
                                            <span title="frequency">1</span>
                                        </li>
                                        <li>
                                            <span title="period">24</span>
                                        </li>
                                        <li>
                                            <span title="periodUnit">h</span>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">condition:
            </td>
                                <td>
                                    <table>
                                        <tr>
                                            <td style="font-weight: bold">kind:
            </td>
                                            <td>
                                                <span title="kind">start</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold">expression:
            </td>
                                            <td>
                                                <ul style="list-style:none; padding-left:0; margin:0 0;">
                                                    <li>
                                                        <span title="description">
                                                            <p>Encounter is active.</p>
                                                        </span>
                                                    </li>
                                                    <li>
                                                        <span title="language">text/cql</span>
                                                    </li>
                                                    <li>
                                                        <span title="expression">encounter.period.start != null and encounter.period.end = null</span>
                                                    </li>
                                                </ul>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">condition:
            </td>
                                <td>
                                    <table>
                                        <tr>
                                            <td style="font-weight: bold">kind:
            </td>
                                            <td>
                                                <span title="kind">stop</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold">expression:
            </td>
                                            <td>
                                                <ul style="list-style:none; padding-left:0; margin:0 0;">
                                                    <li>
                                                        <span title="description">
                                                            <p>Encounter is closed.</p>
                                                        </span>
                                                    </li>
                                                    <li>
                                                        <span title="language">text/cql</span>
                                                    </li>
                                                    <li>
                                                        <span title="expression">encounter.period.end != null</span>
                                                    </li>
                                                </ul>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">relatedAction:
            </td>
                                <td>
                                    <table>
                                        <tr>
                                            <td style="font-weight: bold">actionId:
            </td>
                                            <td>
                                                <span title="actionId">create-eicr</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold">relationship:
            </td>
                                            <td>
                                                <span title="relationship">after</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold">offsetDuration:
            </td>
                                            <td>
                                                <ul style="list-style:none; padding-left:0; margin:0 0;">
                                                    <li>
                                                        <span title="value">24</span>
                                                    </li>
                                                    <li>
                                                        <span title="unit">h</span>
                                                    </li>
                                                </ul>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">action:
            </td>
                    <td>
                        <table>
                            <tr>
                                <td style="font-weight: bold">description:
            </td>
                                <td>
                                    <span title="description">
                                        <p>This action represents the close out of an eICR encounter.</p>
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">textEquivalent:
            </td>
                                <td>
                                    <span title="textEquivalent">eICR encounter close out (z hours) – the time after the end of the encounter to create the final eICR when there have been one or more trigger events.</span>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">trigger:
            </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>
                                            <span title="type">data-added</span>
                                        </li>
                                        <li>
                                            <span title="type">Encounter</span>
                                        </li>
                                        <li>
                                            <span title="profile">http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-encounter</span>
                                        </li>
                                        <li>
                                            <span title="path">period.end</span>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">relatedAction:
            </td>
                                <td>
                                    <table>
                                        <tr>
                                            <td style="font-weight: bold">actionId:
            </td>
                                            <td>
                                                <span title="actionId">create-eicr</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold">relationship:
            </td>
                                            <td>
                                                <span title="relationship">after</span>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">timingTiming:
            </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>
                                            <span title="count">1</span>
                                        </li>
                                        <li>
                                            <span title="duration">24</span>
                                        </li>
                                        <li>
                                            <span title="durationUnit">h</span>
                                        </li>
                                        <li>
                                            <span title="frequency">1</span>
                                        </li>
                                        <li>
                                            <span title="periodUnit">h</span>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">action:
            </td>
                    <td>
                        <table>
                            <tr>
                                <td style="font-weight: bold">description:
            </td>
                                <td>
                                    <span title="description">
                                        <p>This action represents the validation of an eICR.</p>
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">textEquivalent:
            </td>
                                <td>
                                    <span title="textEquivalent">Validate eICR.</span>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">trigger:
            </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>
                                            <span title="type">data-changed</span>
                                        </li>
                                        <li>
                                            <span title="name">eicr-created</span>
                                        </li>
                                        <li>
                                            <span title="type">Composition</span>
                                        </li>
                                        <li>
                                            <span title="profile">http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-composition</span>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">action:
            </td>
                    <td>
                        <table>
                            <tr>
                                <td style="font-weight: bold">description:
            </td>
                                <td>
                                    <span title="description">
                                        <p>This action represents the routing and sending of an eICR.</p>
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">textEquivalent:
            </td>
                                <td>
                                    <span title="textEquivalent">Route and send eICR</span>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">relatedAction:
            </td>
                                <td>
                                    <table>
                                        <tr>
                                            <td style="font-weight: bold">actionId:
            </td>
                                            <td>
                                                <span title="actionId">validate-eicr</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold">relationship:
            </td>
                                            <td>
                                                <span title="relationship">after</span>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </div>
    </text>
    <url value="http://hl7.org/fhir/us/ecr/PlanDefinition/plandefinition-ersd-instance"/>
    <version value="0.1"/>
    <name value="PlanDefinition_eRSD_Instance"/>
    <title value="eRSD PlanDefinition Instance"/>
    <type>
        <coding>
            <system value="http://terminology.hl7.org/CodeSystem/plan-definition-type"/>
            <code value="eca-rule"/>
            <display value="ECA Rule"/>
        </coding>
    </type>
    <status value="active"/>
    <date value="2019-09-15T12:49:11-04:00"/>
    <action id="match-trigger">
        <description value="This action represents the matching of a trigger code to one of the values in the eRSD value sets."/>
        <textEquivalent value="Match of a code to one of the values in the eRSD value sets."/>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-diagnosis"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <path value="Condition.code"/>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-dxtc-example"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-immunization"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <path value="Immunization.vaccineCode"/>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-iztc-example"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-lab-order"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <path value="ServiceReqeust.code"/>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-lotc-example"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-lab-observation"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <path value="Observation.code"/>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-lrtc-example"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-medication"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <path value="MedicationAdministration.medicationCodeableConcept"/>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-mrtc-example"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-organism-substance"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <path value="Observation.code"/>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-ostc-example"/>
                </codeFilter>
            </data>
        </trigger>
    </action>
    <action id="create-eicr">
        <description value="This action represents the initial creation of the eICR."/>
        <textEquivalent value="eICR construction delay (x hours) - time after trigger event before an eICR should be created."/>
        <relatedAction>
            <actionId value="match-trigger"/>
            <relationship value="after"/>
            <offsetDuration>
                <value value="3"/>
                <unit value="h"/>
            </offsetDuration>
        </relatedAction>
    </action>
    <action id="periodic-update-eicr">
        <description value="This action represents the periodic update of the eICR."/>
        <textEquivalent value="eICR periodic update (y hours) – the time after an initial eICR transmission to send a new eICR as an update during long encounters."/>
        <trigger>
            <type value="periodic"/>
            <timingTiming>
                <repeat>
                    <frequency value="1"/>
                    <period value="24"/>
                    <periodUnit value="h"/>
                </repeat>
            </timingTiming>
        </trigger>
        <condition>
            <kind value="start"/>
            <expression>
                <description value="Encounter is active."/>
                <language value="text/cql"/>
                <expression value="encounter.period.start != null and encounter.period.end = null"/></expression>
        </condition>
        <condition>
            <kind value="stop"/>
            <expression>
                <description value="Encounter is closed."/>
                <language value="text/cql"/>
                <expression value="encounter.period.end != null"/></expression>
        </condition>
        <relatedAction>
            <actionId value="create-eicr"/>
            <relationship value="after"/>
            <offsetDuration>
                <value value="24"/>
                <unit value="h"/>
            </offsetDuration>
        </relatedAction>
    </action>
    <action id="close-out-eicr">
        <description value="This action represents the close out of an eICR encounter."/>
        <textEquivalent value="eICR encounter close out (z hours) – the time after the end of the encounter to create the final eICR when there have been one or more trigger events."/>
        <trigger>
            <type value="data-added"/>
            <data>
                <type value="Encounter"/>
                <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-encounter"/>
                <dateFilter>
                    <path value="period.end"/>
                </dateFilter>
            </data>
        </trigger>
        <relatedAction>
            <actionId value="create-eicr"/>
            <relationship value="after"/>
        </relatedAction>
        <timingTiming>
            <repeat>
                <count value="1"/>
                <duration value="24"/>
                <durationUnit value="h"/>
                <frequency value="1"/>
                <periodUnit value="h"/>
            </repeat>
        </timingTiming>
    </action>
    <action id="validate-eicr">
        <description value="This action represents the validation of an eICR."/>
        <textEquivalent value="Validate eICR."/>
        <trigger>
            <type value="data-changed"/>
            <name value="eicr-created"/>
            <data>
                <type value="Composition"/>
                <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-composition"/>
            </data>
        </trigger>
    </action>
    <action id="route-and-send-eicr">
        <description value="This action represents the routing and sending of an eICR."/>
        <textEquivalent value="Route and send eICR"/>
        <relatedAction>
            <actionId value="validate-eicr"/>
            <relationship value="after"/>
        </relatedAction>
    </action>
</PlanDefinition>