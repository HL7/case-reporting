<?xml version="1.0" encoding="UTF-8"?>
<PlanDefinition xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://hl7.org/fhir ../../../../../../../../../../Dropbox/03%20Work/Lantana/Temp_Files/fhir-all-xsd/fhir-all.xsd" xmlns="http://hl7.org/fhir">
    <id value="plandefinition-ersd-instance"/>
    <meta>
        <versionId value="3"/>
        <lastUpdated value="2019-09-18T21:20:03.000-04:00"/>
    </meta>
    <url value="http://hl7.org/fhir/us/ecr/PlanDefinition/plandefinition-ersd-instance"/>
    <version value="0.1"/>
    <name value="PlanDefinition_eRSD_Instance"/>
    <title value="eRSD PlanDefinition Instance"/>
    <type>
        <coding>
            <system value="http://terminology.hl7.org/CodeSystem/plan-definition-type"/>
            <code value="eca-rule"/>
            <display value="ECA Rule"/>
        </coding>
    </type>
    <status value="active"/>
    <date value="2019-09-15T12:49:11-04:00"/>
    <action id="match-trigger">
        <description value="This action represents the matching of a trigger code to one of the values in the RCTC value sets."/>
        <textEquivalent value="Match of a code to one of the values in the RCTC value sets."/>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-diagnosis"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-dxtc"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-immunization"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-iztc"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-lab-order"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-lotc"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-lab-observation"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-lrtc"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-medication"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-mrtc"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-organism-substance"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-ostc"/>
                </codeFilter>
            </data>
        </trigger>
    </action>
    <action id="create-eicr">
        <description value="This action represents the initial creation of the eICR."/>
        <textEquivalent value="eICR construction delay (x hours) - time after trigger event before an eICR should be created."/>
        <relatedAction>
            <actionId value="match-trigger"/>
            <relationship value="after"/>
            <offsetDuration>
                <value value="3"/>
                <unit value="h"/>
            </offsetDuration>
        </relatedAction>
    </action>
    <action id="periodic-update-eicr">
        <description value="This action represents the periodic update of the eICR."/>
        <textEquivalent value="eICR periodic update (y hours) – the time after an initial eICR transmission to send a new eICR as an update during long encounters."/>
        <trigger>
            <type value="periodic"/>
            <timingTiming>
                <repeat>
                    <frequency value="1"/>
                    <period value="24"/>
                    <periodUnit value="h"/>
                </repeat>
            </timingTiming>
        </trigger>
        <condition>
            <kind value="start"/>
            <expression>
                <description value="Encounter is active."/>
                <language value="text/cql"/>
                <expression value="encounter.period.start != null and encounter.period.end = null"/></expression>
        </condition>
        <condition>
            <kind value="stop"/>
            <expression>
                <description value="encounter is closed out"/>
                <language value="text/cql"/>
                <expression value="encounter.period.end != null"/></expression>
        </condition>
        <relatedAction>
            <actionId value="create-eicr"/>
            <relationship value="after"/>
            <offsetDuration>
                <value value="24"/>
                <unit value="h"/>
            </offsetDuration>
        </relatedAction>
    </action>
    <action id="close-out-eicr">
        <description value="This action represents the close out of an eICR encounter."/>
        <textEquivalent value="eICR encounter close out (z hours) – the time after the end of the encounter to create the final eICR when there have been one or more trigger events."/>
        <trigger>
            <type value="data-changed"/>
            <timingTiming>
                <repeat>
                    <count value="1"/>
                    <duration value="24"/>
                    <frequency value="1"/>
                    <periodUnit value="h"/>
                </repeat>
            </timingTiming>
            <data>
                <type value="DateTime"/>
                <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-encounter"/>
                <codeFilter>
                    <path value="encounter.period.end"/>
                </codeFilter>
            </data>
        </trigger>
        <relatedAction>
            <actionId value="create-eicr"/>
            <relationship value="after"/>
        </relatedAction>
    </action>
  <action id="validate-eicr">
    <description value="This action represents the validation of an eICR."/>
    <textEquivalent value="Validate eICR."/>
    <trigger>
      <type value="data-changed"/>
      <name value="eicr-created"/>
      <data>
        <type value="Composition"/>
        <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-composition"/>
      </data>
    </trigger>
  </action>
  <action id="route-and-send-eicr">
    <description value="This action represents the routing and sending of an eICR."/>
    <textEquivalent value="Route and send eICR"/>
    <relatedAction>
      <actionId value="validate-eicr"/>
      <relationship value="after"/>
    </relatedAction>
  </action>
</PlanDefinition>