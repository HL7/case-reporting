<?xml version="1.0" encoding="UTF-8"?>
<PlanDefinition
    xmlns="http://hl7.org/fhir">
    <id value="plandefinition-ersd-instance"/>
    <meta>
        <versionId value="33"/>
        <lastUpdated value="2019-10-03T03:43:26.000-04:00"/>
        <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/ersd-plandefinition"/>
    </meta>
    <text>
        <status value="generated"/>
        <div
            xmlns="http://www.w3.org/1999/xhtml">
            <table
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform" class="bare">
                <tr>
                    <td>
                        <b>Id:</b>
                    </td>
                    <td>plandefinition-ersd-instance</td>
                </tr>
                <tr>
                    <td>
                        <b>Meta:</b>
                    </td>
                    <td>
                        <ul style="list-style:none; padding-left:0; margin:0 0;">
                            <li>32</li>
                            <li>2019-10-01T05:52:52.000-04:00</li>
                            <li>http://hl7.org/fhir/us/ecr/StructureDefinition/ersd-plandefinition</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Url:</b>
                    </td>
                    <td>http://hl7.org/fhir/us/ecr/PlanDefinition/plandefinition-ersd-instance</td>
                </tr>
                <tr>
                    <td>
                        <b>Version:</b>
                    </td>
                    <td>Version: 0.1</td>
                </tr>
                <tr>
                    <td>
                        <b>Name:</b>
                    </td>
                    <td>PlanDefinition_eRSD_Instance</td>
                </tr>
                <tr>
                    <td>
                        <b>Title:</b>
                    </td>
                    <td>eRSD PlanDefinition Instance</td>
                </tr>
                <tr>
                    <td>
                        <b>Type:</b>
                    </td>
                    <td>
                        <ul style="list-style:none; padding-left:0; margin:0 0;">
                            <li>Code: eca-rule</li>
                            <li>Code system: 
                                <a href="http://terminology.hl7.org/CodeSystem/plan-definition-type">http://terminology.hl7.org/CodeSystem/plan-definition-type</a>
                            </li>
                            <li>
                Display: ECA Rule</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Status:</b>
                    </td>
                    <td>active</td>
                </tr>
                <tr>
                    <td>
                        <b>Subject:</b>
                    </td>
                    <td/>
                </tr>
                <tr>
                    <td>
                        <b>Date:</b>
                    </td>
                    <td>2019-09-15T12:49:11-04:00</td>
                </tr>
                <tr>
                    <td>
                        <b>Action:</b>
                    </td>
                    <td>
                        <table class="bare">
                            <tr>
                                <td>
                                    <b>Description:</b>
                                </td>
                                <td>
                                    <p>This action represents the matching of a trigger code to one of the values in the eRSD value sets.</p>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Text Equivalent:</b>
                                </td>
                                <td>Match of a code to one of the values in the eRSD value sets.</td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Subject:</b>
                                </td>
                                <td/>
                            </tr>
                            <tr>
                                <td>
                                    <b>Trigger:</b>
                                </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>named-event</li>
                                        <li>match-trigger-diagnosis</li>
                                        <li>CodeableConcept</li>
                                        <li>Condition.code</li>
                                        <li>http://hl7.org/fhir/us/ecr/ValueSet/valueset-dxtc-example</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Trigger:</b>
                                </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>named-event</li>
                                        <li>match-trigger-immunization</li>
                                        <li>CodeableConcept</li>
                                        <li>Immunization.vaccineCode</li>
                                        <li>http://hl7.org/fhir/us/ecr/ValueSet/valueset-iztc-example</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Trigger:</b>
                                </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>named-event</li>
                                        <li>match-trigger-lab-order</li>
                                        <li>CodeableConcept</li>
                                        <li>ServiceReqeust.code</li>
                                        <li>http://hl7.org/fhir/us/ecr/ValueSet/valueset-lotc-example</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Trigger:</b>
                                </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>named-event</li>
                                        <li>match-trigger-lab-observation</li>
                                        <li>CodeableConcept</li>
                                        <li>Observation.code</li>
                                        <li>http://hl7.org/fhir/us/ecr/ValueSet/valueset-lrtc-example</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Trigger:</b>
                                </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>named-event</li>
                                        <li>match-trigger-medication</li>
                                        <li>CodeableConcept</li>
                                        <li>MedicationAdministration.medicationCodeableConcept</li>
                                        <li>http://hl7.org/fhir/us/ecr/ValueSet/valueset-mrtc-example</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Trigger:</b>
                                </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>named-event</li>
                                        <li>match-trigger-organism-substance</li>
                                        <li>CodeableConcept</li>
                                        <li>Observation.code</li>
                                        <li>http://hl7.org/fhir/us/ecr/ValueSet/valueset-ostc-example</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Timing:</b>
                                </td>
                                <td/>
                            </tr>
                            <tr>
                                <td>
                                    <b>Definition:</b>
                                </td>
                                <td/>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Action:</b>
                    </td>
                    <td>
                        <table class="bare">
                            <tr>
                                <td>
                                    <b>Description:</b>
                                </td>
                                <td>
                                    <p>This action represents the initial creation of the eICR.</p>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Text Equivalent:</b>
                                </td>
                                <td>eICR construction delay (x hours) - time after trigger event before an eICR should be created.</td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Subject:</b>
                                </td>
                                <td/>
                            </tr>
                            <tr>
                                <td>
                                    <b>Related Action:</b>
                                </td>
                                <td>
                                    <table class="bare">
                                        <tr>
                                            <td>
                                                <b>Action Id:</b>
                                            </td>
                                            <td>match-trigger</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <b>Relationship:</b>
                                            </td>
                                            <td>after</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <b>Offset Duration:</b>
                                            </td>
                                            <td>
                                                <ul style="list-style:none; padding-left:0; margin:0 0;">
                                                    <li>3</li>
                                                    <li>h</li>
                                                </ul>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <b>Offset:</b>
                                            </td>
                                            <td/>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Timing:</b>
                                </td>
                                <td/>
                            </tr>
                            <tr>
                                <td>
                                    <b>Definition:</b>
                                </td>
                                <td/>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Action:</b>
                    </td>
                    <td>
                        <table class="bare">
                            <tr>
                                <td>
                                    <b>Description:</b>
                                </td>
                                <td>
                                    <p>This action represents the periodic update of the eICR.</p>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Text Equivalent:</b>
                                </td>
                                <td>eICR periodic update (y hours) – the time after an initial eICR transmission to send a new eICR as an update during long encounters.</td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Subject:</b>
                                </td>
                                <td/>
                            </tr>
                            <tr>
                                <td>
                                    <b>Trigger:</b>
                                </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>periodic</li>
                                        <li>1</li>
                                        <li>24</li>
                                        <li>h</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Condition:</b>
                                </td>
                                <td>
                                    <table class="bare">
                                        <tr>
                                            <td>
                                                <b>Kind:</b>
                                            </td>
                                            <td>start</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <b>Expression:</b>
                                            </td>
                                            <td>
                                                <ul style="list-style:none; padding-left:0; margin:0 0;">
                                                    <li>
                                                        <p>Encounter is active.</p>
                                                    </li>
                                                    <li>text/cql</li>
                                                    <li>encounter.period.start != null and encounter.period.end = null</li>
                                                </ul>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Condition:</b>
                                </td>
                                <td>
                                    <table class="bare">
                                        <tr>
                                            <td>
                                                <b>Kind:</b>
                                            </td>
                                            <td>stop</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <b>Expression:</b>
                                            </td>
                                            <td>
                                                <ul style="list-style:none; padding-left:0; margin:0 0;">
                                                    <li>
                                                        <p>Encounter is closed.</p>
                                                    </li>
                                                    <li>text/cql</li>
                                                    <li>encounter.period.end != null</li>
                                                </ul>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Related Action:</b>
                                </td>
                                <td>
                                    <table class="bare">
                                        <tr>
                                            <td>
                                                <b>Action Id:</b>
                                            </td>
                                            <td>create-eicr</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <b>Relationship:</b>
                                            </td>
                                            <td>after</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <b>Offset Duration:</b>
                                            </td>
                                            <td>
                                                <ul style="list-style:none; padding-left:0; margin:0 0;">
                                                    <li>24</li>
                                                    <li>h</li>
                                                </ul>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <b>Offset:</b>
                                            </td>
                                            <td/>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Timing:</b>
                                </td>
                                <td/>
                            </tr>
                            <tr>
                                <td>
                                    <b>Definition:</b>
                                </td>
                                <td/>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Action:</b>
                    </td>
                    <td>
                        <table class="bare">
                            <tr>
                                <td>
                                    <b>Description:</b>
                                </td>
                                <td>
                                    <p>This action represents the close out of an eICR encounter.</p>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Text Equivalent:</b>
                                </td>
                                <td>eICR encounter close out (z hours) – the time after the end of the encounter to create the final eICR when there have been one or more trigger events.</td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Subject:</b>
                                </td>
                                <td/>
                            </tr>
                            <tr>
                                <td>
                                    <b>Trigger:</b>
                                </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>data-added</li>
                                        <li>Encounter</li>
                                        <li>http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-encounter</li>
                                        <li>period.end</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Related Action:</b>
                                </td>
                                <td>
                                    <table class="bare">
                                        <tr>
                                            <td>
                                                <b>Action Id:</b>
                                            </td>
                                            <td>create-eicr</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <b>Relationship:</b>
                                            </td>
                                            <td>after</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <b>Offset:</b>
                                            </td>
                                            <td/>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Timing Timing:</b>
                                </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>1</li>
                                        <li>24</li>
                                        <li>h</li>
                                        <li>1</li>
                                        <li>h</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Timing:</b>
                                </td>
                                <td/>
                            </tr>
                            <tr>
                                <td>
                                    <b>Definition:</b>
                                </td>
                                <td/>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Action:</b>
                    </td>
                    <td>
                        <table class="bare">
                            <tr>
                                <td>
                                    <b>Description:</b>
                                </td>
                                <td>
                                    <p>This action represents the validation of an eICR.</p>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Text Equivalent:</b>
                                </td>
                                <td>Validate eICR.</td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Subject:</b>
                                </td>
                                <td/>
                            </tr>
                            <tr>
                                <td>
                                    <b>Trigger:</b>
                                </td>
                                <td>
                                    <ul style="list-style:none; padding-left:0; margin:0 0;">
                                        <li>data-changed</li>
                                        <li>eicr-created</li>
                                        <li>Composition</li>
                                        <li>http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-composition</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Timing:</b>
                                </td>
                                <td/>
                            </tr>
                            <tr>
                                <td>
                                    <b>Definition:</b>
                                </td>
                                <td/>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Action:</b>
                    </td>
                    <td>
                        <table class="bare">
                            <tr>
                                <td>
                                    <b>Description:</b>
                                </td>
                                <td>
                                    <p>This action represents the routing and sending of an eICR.</p>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Text Equivalent:</b>
                                </td>
                                <td>Route and send eICR</td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Subject:</b>
                                </td>
                                <td/>
                            </tr>
                            <tr>
                                <td>
                                    <b>Related Action:</b>
                                </td>
                                <td>
                                    <table class="bare">
                                        <tr>
                                            <td>
                                                <b>Action Id:</b>
                                            </td>
                                            <td>validate-eicr</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <b>Relationship:</b>
                                            </td>
                                            <td>after</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <b>Offset:</b>
                                            </td>
                                            <td/>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <b>Timing:</b>
                                </td>
                                <td/>
                            </tr>
                            <tr>
                                <td>
                                    <b>Definition:</b>
                                </td>
                                <td/>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </div>
    </text>
    <url value="http://hl7.org/fhir/us/ecr/PlanDefinition/plandefinition-ersd-instance"/>
    <version value="0.1"/>
    <name value="PlanDefinition_eRSD_Instance"/>
    <title value="eRSD PlanDefinition Instance"/>
    <type>
        <coding>
            <system value="http://terminology.hl7.org/CodeSystem/plan-definition-type"/>
            <code value="eca-rule"/>
            <display value="ECA Rule"/>
        </coding>
    </type>
    <status value="active"/>
    <date value="2019-09-15T12:49:11-04:00"/>
    <action id="match-trigger">
        <description value="This action represents the matching of a trigger code to one of the values in the eRSD value sets."/>
        <textEquivalent value="Match of a code to one of the values in the eRSD value sets."/>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-diagnosis"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <path value="Condition.code"/>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-dxtc-example"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-immunization"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <path value="Immunization.vaccineCode"/>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-iztc-example"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-lab-order"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <path value="ServiceReqeust.code"/>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-lotc-example"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-lab-observation"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <path value="Observation.code"/>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-lrtc-example"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-medication"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <path value="MedicationAdministration.medicationCodeableConcept"/>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-mrtc-example"/>
                </codeFilter>
            </data>
        </trigger>
        <trigger>
            <type value="named-event"/>
            <name value="match-trigger-organism-substance"/>
            <data>
                <type value="CodeableConcept"/>
                <codeFilter>
                    <path value="Observation.code"/>
                    <valueSet value="http://hl7.org/fhir/us/ecr/ValueSet/valueset-ostc-example"/>
                </codeFilter>
            </data>
        </trigger>
    </action>
    <action id="create-eicr">
        <description value="This action represents the initial creation of the eICR."/>
        <textEquivalent value="eICR construction delay (x hours) - time after trigger event before an eICR should be created."/>
        <relatedAction>
            <actionId value="match-trigger"/>
            <relationship value="after"/>
            <offsetDuration>
                <value value="3"/>
                <unit value="h"/>
            </offsetDuration>
        </relatedAction>
    </action>
    <action id="periodic-update-eicr">
        <description value="This action represents the periodic update of the eICR."/>
        <textEquivalent value="eICR periodic update (y hours) – the time after an initial eICR transmission to send a new eICR as an update during long encounters."/>
        <trigger>
            <type value="periodic"/>
            <timingTiming>
                <repeat>
                    <frequency value="1"/>
                    <period value="24"/>
                    <periodUnit value="h"/>
                </repeat>
            </timingTiming>
        </trigger>
        <condition>
            <kind value="start"/>
            <expression>
                <description value="Encounter is active."/>
                <language value="text/cql"/>
                <expression value="encounter.period.start != null and encounter.period.end = null"/></expression>
        </condition>
        <condition>
            <kind value="stop"/>
            <expression>
                <description value="Encounter is closed."/>
                <language value="text/cql"/>
                <expression value="encounter.period.end != null"/></expression>
        </condition>
        <relatedAction>
            <actionId value="create-eicr"/>
            <relationship value="after"/>
            <offsetDuration>
                <value value="24"/>
                <unit value="h"/>
            </offsetDuration>
        </relatedAction>
    </action>
    <action id="close-out-eicr">
        <description value="This action represents the close out of an eICR encounter."/>
        <textEquivalent value="eICR encounter close out (z hours) – the time after the end of the encounter to create the final eICR when there have been one or more trigger events."/>
        <trigger>
            <type value="data-added"/>
            <data>
                <type value="Encounter"/>
                <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-encounter"/>
                <dateFilter>
                    <path value="period.end"/>
                </dateFilter>
            </data>
        </trigger>
        <relatedAction>
            <actionId value="create-eicr"/>
            <relationship value="after"/>
        </relatedAction>
        <timingTiming>
            <repeat>
                <count value="1"/>
                <duration value="24"/>
                <durationUnit value="h"/>
                <frequency value="1"/>
                <periodUnit value="h"/>
            </repeat>
        </timingTiming>
    </action>
    <action id="validate-eicr">
        <description value="This action represents the validation of an eICR."/>
        <textEquivalent value="Validate eICR."/>
        <trigger>
            <type value="data-changed"/>
            <name value="eicr-created"/>
            <data>
                <type value="Composition"/>
                <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-composition"/>
            </data>
        </trigger>
    </action>
    <action id="route-and-send-eicr">
        <description value="This action represents the routing and sending of an eICR."/>
        <textEquivalent value="Route and send eICR"/>
        <relatedAction>
            <actionId value="validate-eicr"/>
            <relationship value="after"/>
        </relatedAction>
    </action>
</PlanDefinition>