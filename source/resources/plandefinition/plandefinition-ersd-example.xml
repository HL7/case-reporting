<?xml version="1.0" encoding="UTF-8"?>
<PlanDefinition
    xmlns="http://hl7.org/fhir">
    <id value="plandefinition-ersd-example"/>
    <meta>
        <versionId value="4"/>
        <lastUpdated value="2019-08-28T18:23:18.000-04:00"/>
        <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/ersd-plandefinition"/>
    </meta>
    <url value="http://hl7.org/fhir/us/ecr/PlanDefinition/plandefinition-ersd-example"/>
    <version value="0.1"/>
    <name value="PlanDefinition_eRSD_Example"/>
    <title value="eRSD PlanDefinition Example"/>
    <type>
        <coding>
            <system value="http://terminology.hl7.org/CodeSystem/plan-definition-type"/>
            <code value="eca-rule"/>
            <display value="ECA Rule"/>
        </coding>
    </type>
    <status value="active"/>
    <date value="2019-07-26T12:49:11-04:00"/>
    <relatedArtifact>
        <type value="depends-on"/>
        <display value="Reportable Condition Trigger Codes (RCTC)"/>
        <resource value="http://hl7.org/fhir/us/ecr/Library/library-rctc"/>
    </relatedArtifact>
    <action id="orchestration">
        <description value="This action contains rules processing orchestration actions and information."/>
        <textEquivalent value="Pick between the two sequence options based on rules processing: Healthcare-based processing, or RCKMS Rules Processing on AIMS Platform"/>
        <selectionBehavior value="exactly-one"/>
        <action id="healthcare-based">
            <description value="Healthcare-based rules processing workflow"/>
            <textEquivalent value="Rules processing, clinical feedback, eicr, route and send."/>
            <condition>
                <kind value="applicability"/>
                <expression>
                    <description value="Healthcare facility has rules processing capability"/>
                    <language value="text/cql"/>
                    <expression value="RulesProcessing() = true"/></expression>
            </condition>
            <action id="rules-processing">
                <description value="This action contains rules processing that is executed in a healthcare organization or business associate."/>
                <textEquivalent value="Rules Processing is executed in Healthcare organization or business associate."/>
                <trigger>
                    <type value="named-event"/>
                    <name value="orchestration is completed"/>
                </trigger>
            </action>
            <action id="clinical-feedback">
                <description value="clinical feedback"/>
                <textEquivalent value="Create clinical feedback for reportable and may be reportable conditons."/>
                <trigger>
                    <type value="named-event"/>
                    <name value="rules processing is completed"/>
                </trigger>
                <condition>
                    <kind value="applicability"/>
                    <expression>
                        <description value="If rules processing determines reportable or may be reportable, then create clinical feedback"/>
                        <language value="text/cql"/>
                        <expression value="Reportable() = true or MayBeReportable() = true"/></expression>
                </condition>
            </action>
            <action id="eicr">
                <description value="This action contains eICR creation, update, and close out actions and information."/>
                <textEquivalent value="Create: initial eicr, periodic update eicr, close out eicr."/>
                <selectionBehavior value="at-most-one"/>
                <action id="create-eicr">
                    <description value="This action represents the initial creation of the eICR."/>
                    <textEquivalent value="Delay eICR construction (x hours) - time after the start of the encounter before a triggered eICR should be composed and sent."/>
                    <relatedAction>
                        <actionId value="orchestration"/>
                        <relationship value="after-end"/>
                        <offsetDuration>
                            <value value="3"/>
                            <unit value="h"/>
                        </offsetDuration>
                    </relatedAction>
                </action>
                <action id="periodic-eicr">
                    <description value="This action represents the periodic update of the eICR."/>
                    <textEquivalent value="eICR periodic update (y hours) – the time after a previous eICR transmission to send a new eICR as an update during long encounters."/>
                    <trigger>
                        <type value="periodic"/>
                        <timingTiming>
                            <repeat>
                                <frequency value="1"/>
                                <period value="24"/>
                                <periodUnit value="h"/>
                            </repeat>
                        </timingTiming>
                    </trigger>
                    <condition>
                        <kind value="applicability"/>
                        <expression>
                            <description value="A trigger code was matched, encounter is still active, and 24 hours have passed after the last eicr was sent."/>
                            <language value="text/cql"/>
                            <expression value="TriggerCode() = true and EncounterActive() = true and (LastEncounterSentTime() - CurrentTime() &gt; 24)"/></expression>
                    </condition>
                    <condition>
                        <kind value="stop"/>
                        <expression>
                            <description value="encounter is closed out"/>
                            <language value="text/cql"/>
                            <expression value="EncounterClosed() = true"/></expression>
                    </condition>
                    <relatedAction>
                        <actionId value="create-eicr"/>
                        <relationship value="after-end"/>
                        <offsetDuration>
                            <value value="24"/>
                            <unit value="h"/>
                        </offsetDuration>
                    </relatedAction>
                </action>
                <action id="close-out-eicr">
                    <description value="This action represents an eICR encounter close out."/>
                    <textEquivalent value="eICR encounter close out (z hours) - the time after the end of an encounter for a final eICR will be sent when there has been one or more trigger events"/>
                    <trigger>
                        <type value="named-event"/>
                        <name value="encounter close out"/>
                        <timingTiming>
                            <repeat>
                                <boundsDuration>
                                    <value value="3"/>
                                    <unit value="h"/>
                                    <system value="http://unitsofmeasure.org"/>
                                    <code value="h"/>
                                </boundsDuration>
                            </repeat>
                        </timingTiming>
                    </trigger>
                    <condition>
                        <kind value="applicability"/>
                        <expression>
                            <description value="There has been one or more trigger event."/>
                            <language value="text/cql"/>
                            <expression value="TriggerEventCount() &gt;= 1"/></expression>
                    </condition>
                </action>
            </action>
            <action id="route-and-send">
                <description value="This action represents the routing and sending of an eICR as per rules processing."/>
                <textEquivalent value="Route and send eicr per rules processing"/>
                <trigger>
                    <type value="named-event"/>
                    <name value="creation of eicr complete"/>
                </trigger>
                <condition>
                    <kind value="applicability"/>
                    <expression>
                        <description value="There has been one or more trigger event."/>
                        <language value="text/cql"/>
                        <expression value="TriggerEventCount() &gt;= 1"/></expression>
                </condition>
            </action>
        </action>
        <action id="aims-platform-rules-processing">
            <description value="This action defines the platform-based rules processing workflow including the steps/actions to be taken when Rules Processing is performed by the RCKMS System on the AIMS Platform."/>
            <textEquivalent value="eICR, send from clinical care to platform, platform rules-processing, creation of clinical feedback"/>
            <action id="eicr-platform">
                <description value="This action contains eICR creation, update, and close out actions and information."/>
                <textEquivalent value="Create: initial eicr, periodic update eicr, close out eicr."/>
                <selectionBehavior value="at-most-one"/>
                <action id="create-eicr-platform">
                    <description value="This action represents the initial creation of the eICR."/>
                    <textEquivalent value="delay eICR construction (x hours) - time after the start of the encounter before a triggered eICR should be composed and sent"/>
                    <relatedAction>
                        <actionId value="orchestration"/>
                        <relationship value="after-end"/>
                        <offsetDuration>
                            <value value="3"/>
                            <unit value="h"/>
                        </offsetDuration>
                    </relatedAction>
                </action>
                <action id="periodic-eicr-platform">
                    <description value="This action represents the periodic update of the eICR."/>
                    <textEquivalent value="eICR periodic update (y hours) - the time after an initial eICR transmission to send new eICRs as updates for long encounters"/>
                    <trigger>
                        <type value="periodic"/>
                        <timingTiming>
                            <repeat>
                                <frequency value="1"/>
                                <period value="24"/>
                                <periodUnit value="h"/>
                            </repeat>
                        </timingTiming>
                    </trigger>
                    <condition>
                        <kind value="applicability"/>
                        <expression>
                            <description value="A trigger code was matched, encounter is still active, and 24 hours have passed after the last eicr was sent"/>
                            <language value="text/cql"/>
                            <expression value="TriggerCode() = true and EncounterActive() = true and (LastEncounterSentTime() - CurrentTime() &gt; 24)"/></expression>
                    </condition>
                    <condition>
                        <kind value="stop"/>
                        <expression>
                            <description value="encounter is closed out"/>
                            <language value="text/cql"/>
                            <expression value="EncounterClosed() = true"/></expression>
                    </condition>
                    <relatedAction>
                        <actionId value="create-eicr-platform"/>
                        <relationship value="after-end"/>
                        <offsetDuration>
                            <value value="24"/>
                            <unit value="h"/>
                        </offsetDuration>
                    </relatedAction>
                </action>
                <action id="close-out-eicr">
                    <description value="This action represents an eICR encounter close out."/>
                    <textEquivalent value="eICR encounter close out (z hours) – the time after the end of an encounter for a final eICR will be sent when there has been one or more trigger events"/>
                    <trigger>
                        <type value="named-event"/>
                        <name value="encounter close out"/>
                        <timingTiming>
                            <repeat>
                                <boundsDuration>
                                    <value value="3"/>
                                    <unit value="h"/>
                                    <system value="http://unitsofmeasure.org"/>
                                    <code value="h"/>
                                </boundsDuration>
                            </repeat>
                        </timingTiming>
                    </trigger>
                    <condition>
                        <kind value="applicability"/>
                        <expression>
                            <description value="There has been one or more trigger event."/>
                            <language value="text/cql"/>
                            <expression value="TriggerEventCount() = true"/></expression>
                    </condition>
                </action>
            </action>
            <action id="send-clinical-care-platform">
                <description value="This action represents the sending of an eICR from clinical care to the platform."/>
                <textEquivalent value="Send from clinical care to platform"/>
                <trigger>
                    <type value="named-event"/>
                    <name value="Creation of eICR complete"/>
                </trigger>
            </action>
            <action id="platform-rules-processing">
                <description value="This action represents the platform rules processing on receipt of an eICR."/>
                <textEquivalent value="Platform rules processing"/>
                <trigger>
                    <type value="named-event"/>
                    <name value="eICR Received"/>
                </trigger>
            </action>
            <action id="create-clinical-feedback">
                <description value="This action represens the creation of clinical feedback per results of rules processing."/>
                <textEquivalent value="Create clinical feedback per rules results."/>
                <trigger>
                    <type value="named-event"/>
                    <name value="Rules processing complete."/>
                </trigger>
            </action>
        </action>
    </action>
</PlanDefinition>