<?xml version="1.0" encoding="UTF-8"?>
<PlanDefinition
    xmlns="http://hl7.org/fhir">
    <id value="plandefinition-ersd-skeleton"/>
    <meta>
        <versionId value="3"/>
        <lastUpdated value="2020-10-28T06:46:34.193+00:00"/>
        <source value="#XqswQ9TFcZ3l7jIc"/>
        <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/ersd-plandefinition"/>
    </meta>
    <url value="http://hl7.org/fhir/us/ecr/PlanDefinition/plandefinition-ersd-skeleton"/>
    <version value="0.1"/>
    <name value="PlanDefinition_eRSD_Skeleton_Instance"/>
    <title value="eRSD PlanDefinition Skeleton Instance"/>
    <type>
        <coding>
          <system value="http://hl7.org/fhir/us/ecr/CodeSystem/ExecutableTaskTypes"/>
          <code value="check-reportable"/>
        </coding>
      </code>
      <condition>
        <kind value="applicability"/>
        <expression>
          <language value="text/cql.identifier"/>
          <expression value="Is Reportable"/>
        </expression>
      </condition>
      <relatedAction>
        <actionId value="create-and-report-eicr"/>
        <relationship value="before-start"/>
      </relatedAction>
    </action>
    <action>
      <condition>
        <kind value="applicability"/>
        <expression>
          <language value="text/cql.identifier"/>
          <expression value="Is Encounter In Progress"/>
        </expression>
      </condition>
      <relatedAction>
        <actionId value="check-reportable"/>
        <relationship value="before-start"/>
        <offsetDuration>
          <value value="6"/>
          <code value="h"/>
        </offsetDuration>
      </relatedAction>
    </action>
  </action>
  <action id="create-and-report-eicr">
    <description value="This action represents the creation and reporting of an eICR."/>
    <textEquivalent value="Create and Report eICR"/>
    <code>
      <coding>
        <system value="http://hl7.org/fhir/us/ecr/CodeSystem/ExecutableTaskTypes"/>
        <code value="create-and-report-eicr"/>
      </coding>
    </code>
    <action>
      <relatedAction>
        <actionId value="report-eicr"/>
        <relationship value="before-start"/>
      </relatedAction>
    </action>
    <action>
      <condition>
        <kind value="applicability"/>
        <expression>
          <language value="text/cql.identifier"/>
          <expression value="Is Encounter Complete"/>
        </expression>
      </condition>
      <relatedAction>
        <actionId value="report-eicr"/>
        <relationship value="before-start"/>
        <offsetDuration>
          <value value="24"/>
          <code value="h"/>
        </offsetDuration>
      </relatedAction>
    </action>
    <action id="close-out-eicr">
        <description value="This action represents the close out of an eICR encounter."/>
        <textEquivalent value="eICR encounter close out (timingTiming.repeat.duration = z hours) - the time after the end of the encounter to create the final eICR when there have been one or more trigger events."/>
        <trigger>
            <type value="data-added"/>
            <data>
                <type value="Encounter"/>
                <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-encounter"/>
                <dateFilter>
                    <path value="period.end"/>
                </dateFilter>
            </data>
        </trigger>
        <relatedAction>
            <actionId value="create-eicr"/>
            <relationship value="after"/>
        </relatedAction>
        <timingTiming>
            <repeat>
                <count value="1"/>
                <duration value="24"/>
                <durationUnit value="h"/>
                <frequency value="1"/>
            </repeat>
        </timingTiming>
    </action>
  </action>
  <action id="create-eicr">
    <description value="This action represents the creation of an eICR."/>
    <textEquivalent value="Create eICR."/>
    <code>
      <coding>
        <system value="http://hl7.org/fhir/us/ecr/CodeSystem/ExecutableTaskTypes"/>
        <code value="create-eicr"/>
      </coding>
    </code>
  </action>
  <action id="validate-eicr">
    <description value="This action represents the validation of an eICR."/>
    <textEquivalent value="Validate eICR."/>
    <code>
      <coding>
        <system value="http://hl7.org/fhir/us/ecr/CodeSystem/ExecutableTaskTypes"/>
        <code value="validate-eicr"/>
      </coding>
    </code>
  </action>
  <action id="route-and-send-eicr">
    <description value="This action represents the routing and sending of an eICR."/>
    <textEquivalent value="Route and send eICR"/>
    <code>
      <coding>
        <system value="http://hl7.org/fhir/us/ecr/CodeSystem/ExecutableTaskTypes"/>
        <code value="route-and-send-eicr"/>
      </coding>
    </code>
  </action>
  <action id="report-eicr">
    <description value="This action represents the reporting of an eICR."/>
    <textEquivalent value="Report eICR"/>
    <action>
      <code>
        <coding>
          <system value="http://hl7.org/fhir/us/ecr/CodeSystem/ExecutableTaskTypes"/>
          <code value="report-eicr"/>
        </coding>
      </code>
      <relatedAction>
        <actionId value="create-eicr"/>
        <relationship value="before-start"/>
      </relatedAction>
      <relatedAction>
        <actionId value="validate-eicr"/>
        <relationship value="before-start"/>
      </relatedAction>
      <relatedAction>
        <actionId value="route-and-send-eicr"/>
        <relationship value="before-start"/>
      </relatedAction>
    </action>
  </action>
</PlanDefinition>
