<?xml version="1.0" encoding="UTF-8"?>
<PlanDefinition
    xmlns="http://hl7.org/fhir">
    <id value="plandefinition-ersd-instance"/>
    <meta>
        <versionId value="4"/>
        <lastUpdated value="2020-10-28T06:46:34.307+00:00"/>
        <source value="#NPG0vaN67fvHEMyv"/>
        <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/ersd-plandefinition"/>
    </meta>
    <text>
        <status value="generated"/>
        <div
            xmlns="http://www.w3.org/1999/xhtml">
            <table
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
                <tr>
                    <td style="font-weight: bold">id</td>
                    <td>
                        <div title="id">plandefinition-ersd-instance</div>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">meta</td>
                    <td>
                        <table>
                          <tr>
                            <td style="font-weight: bold">repeat</td>
                            <td>
                              <table>
                                <tr>
                                  <td style="font-weight: bold">frequency</td>
                                  <td>
                                    <div title="frequency">1</div>
                                  </td>
                                </tr>
                                <tr>
                                  <td style="font-weight: bold">period</td>
                                  <td>
                                    <div title="period">24</div>
                                  </td>
                                </tr>
                                <tr>
                                  <td style="font-weight: bold">periodUnit</td>
                                  <td>
                                    <div title="periodUnit">h</div>
                                  </td>
                                </tr>
                              </table>
                            </td>
                          </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">url</td>
                    <td>
                        <div title="url">http://hl7.org/fhir/us/ecr/PlanDefinition/plandefinition-ersd-instance</div>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">version</td>
                    <td>
                        <div title="version">0.1</div>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">name</td>
                    <td>
                        <div title="name">PlanDefinition_eRSD_Instance</div>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">title</td>
                    <td>
                        <div title="title">eRSD PlanDefinition Instance</div>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">type</td>
                    <td>
                        <ul style="list-style:none; padding-left:0; margin:0 0;">
                            <li>
                                <ul style="list-style:none; padding-left:0; margin:0 0;">
                                    <li>
                                        <div title="display">ECA Rule</div>  (
                                        
                                        <div title="code">eca-rule</div> )
          
                                    
                                    </li>
                                    <li>
                                        <div title="system">
                                            <a href="http://terminology.hl7.org/CodeSystem/plan-definition-type">http://terminology.hl7.org/CodeSystem/plan-definition-type</a>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">status</td>
                    <td>
                        <div title="status">active</div>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">date</td>
                    <td>
                        <div title="date">2019-09-15T12:49:11-04:00</div>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold">action</td>
                    <td>
                        <table>
                          <tr>
                            <td style="font-weight: bold">description</td>
                            <td>
                              <div title="description">
                                <p>Encounter is active.</p>
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <td style="font-weight: bold">language</td>
                            <td>
                              <div title="language">text/cql</div>
                            </td>
                          </tr>
                          <tr>
                            <td style="font-weight: bold">expression</td>
                            <td>
                              <div title="expression">encounter.period.start != null and encounter.period.end = null</div>
                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td style="font-weight: bold">condition</td>
                <td>
                  <table>
                    <tr>
                      <td style="font-weight: bold">kind</td>
                      <td>
                        <div title="kind">stop</div>
                      </td>
                    </tr>
                    <tr>
                      <td style="font-weight: bold">expression</td>
                      <td>
                        <table>
                          <tr>
                            <td style="font-weight: bold">description</td>
                            <td>
                              <div title="description">
                                <p>Encounter is closed.</p>
                              </div>
                            </td>
                          </tr>
                          <tr>
                            <td style="font-weight: bold">language</td>
                            <td>
                              <div title="language">text/cql</div>
                            </td>
                          </tr>
                          <tr>
                            <td style="font-weight: bold">expression</td>
                            <td>
                              <div title="expression">encounter.period.end != null</div>
                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td style="font-weight: bold">relatedAction</td>
                <td>
                  <table>
                    <tr>
                      <td style="font-weight: bold">actionId</td>
                      <td>
                        <div title="actionId">create-eicr</div>
                      </td>
                    </tr>
                    <tr>
                      <td style="font-weight: bold">relationship</td>
                      <td>
                        <div title="relationship">after</div>
                      </td>
                    </tr>
                    <tr>
                      <td style="font-weight: bold">offsetDuration</td>
                      <td>
                        <table>
                          <tr>
                            <td style="font-weight: bold">value</td>
                            <td>
                              <div title="value">24</div>
                            </td>
                          </tr>
                          <tr>
                            <td style="font-weight: bold">unit</td>
                            <td>
                              <div title="unit">h</div>
                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td style="font-weight: bold">action</td>
          <td>
            <table>
              <tr>
                <td style="font-weight: bold">description</td>
                <td>
                  <div title="description">
                    <p>This action represents the close out of an eICR encounter.</p>
                  </div>
                </td>
              </tr>
              <tr>
                <td style="font-weight: bold">textEquivalent</td>
                <td>
                  <div title="textEquivalent">eICR encounter close out (timingTiming.repeat.duration = z hours) - the time after the end of the encounter to create the final eICR when there have been one or more trigger events.</div>
                </td>
              </tr>
              <tr>
                <td style="font-weight: bold">trigger</td>
                <td>
                  <table>
                    <tr>
                      <td style="font-weight: bold">type</td>
                      <td>
                        <div title="type">data-added</div>
                      </td>
                    </tr>
                    <tr>
                      <td style="font-weight: bold">data</td>
                      <td>
                        <table>
                            <tr>
                                <td style="font-weight: bold">description</td>
                                <td>
                                    <div title="description">
                                        <p>This action represents the close out of an eICR encounter.</p>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">textEquivalent</td>
                                <td>
                                    <div title="textEquivalent">eICR encounter close out (timingTiming.repeat.duration = z hours) - the time after the end of the encounter to create the final eICR when there have been one or more trigger events.</div>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">trigger</td>
                                <td>
                                    <table>
                                        <tr>
                                            <td style="font-weight: bold">type</td>
                                            <td>
                                                <div title="type">data-added</div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold">data</td>
                                            <td>
                                                <table>
                                                    <tr>
                                                        <td style="font-weight: bold">type</td>
                                                        <td>
                                                            <div title="type">Encounter</div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style="font-weight: bold">profile</td>
                                                        <td>
                                                            <div title="profile">http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-encounter</div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style="font-weight: bold">dateFilter</td>
                                                        <td>
                                                            <table>
                                                                <tr>
                                                                    <td style="font-weight: bold">path</td>
                                                                    <td>
                                                                        <div title="path">period.end</div>
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">relatedAction</td>
                                <td>
                                    <table>
                                        <tr>
                                            <td style="font-weight: bold">actionId</td>
                                            <td>
                                                <div title="actionId">create-eicr</div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold">relationship</td>
                                            <td>
                                                <div title="relationship">after</div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold">timingTiming</td>
                                <td>
                                    <table>
                                        <tr>
                                            <td style="font-weight: bold">repeat</td>
                                            <td>
                                                <table>
                                                    <tr>
                                                        <td style="font-weight: bold">count</td>
                                                        <td>
                                                            <div title="count">1</div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style="font-weight: bold">duration</td>
                                                        <td>
                                                            <div title="duration">24</div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style="font-weight: bold">durationUnit</td>
                                                        <td>
                                                            <div title="durationUnit">h</div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style="font-weight: bold">frequency</td>
                                                        <td>
                                                            <div title="frequency">1</div>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td style="font-weight: bold">relatedAction</td>
                <td>
                  <table>
                    <tr>
                      <td style="font-weight: bold">actionId</td>
                      <td>
                        <div title="actionId">create-eicr</div>
                      </td>
                    </tr>
                    <tr>
                      <td style="font-weight: bold">relationship</td>
                      <td>
                        <div title="relationship">after</div>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td style="font-weight: bold">timingTiming</td>
                <td>
                  <table>
                    <tr>
                      <td style="font-weight: bold">repeat</td>
                      <td>
                        <table>
                          <tr>
                            <td style="font-weight: bold">count</td>
                            <td>
                              <div title="count">1</div>
                            </td>
                          </tr>
                          <tr>
                            <td style="font-weight: bold">duration</td>
                            <td>
                              <div title="duration">24</div>
                            </td>
                          </tr>
                          <tr>
                            <td style="font-weight: bold">durationUnit</td>
                            <td>
                              <div title="durationUnit">h</div>
                            </td>
                          </tr>
                          <tr>
                            <td style="font-weight: bold">frequency</td>
                            <td>
                              <div title="frequency">1</div>
                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td style="font-weight: bold">action</td>
          <td>
            <table>
              <tr>
                <td style="font-weight: bold">description</td>
                <td>
                  <div title="description">
                    <p>This action represents the validation of an eICR.</p>
                  </div>
                </td>
              </tr>
              <tr>
                <td style="font-weight: bold">textEquivalent</td>
                <td>
                  <div title="textEquivalent">Validate eICR.</div>
                </td>
              </tr>
              <tr>
                <td style="font-weight: bold">trigger</td>
                <td>
                  <table>
                    <tr>
                      <td style="font-weight: bold">type</td>
                      <td>
                        <div title="type">data-changed</div>
                      </td>
                    </tr>
                    <tr>
                      <td style="font-weight: bold">name</td>
                      <td>
                        <div title="name">eicr-created</div>
                      </td>
                    </tr>
                    <tr>
                      <td style="font-weight: bold">data</td>
                      <td>
                        <table>
                          <tr>
                            <td style="font-weight: bold">type</td>
                            <td>
                              <div title="type">Composition</div>
                            </td>
                          </tr>
                          <tr>
                            <td style="font-weight: bold">profile</td>
                            <td>
                              <div title="profile">http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-composition</div>
                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td style="font-weight: bold">action</td>
          <td>
            <table>
              <tr>
                <td style="font-weight: bold">description</td>
                <td>
                  <div title="description">
                    <p>This action represents the routing and sending of an eICR.</p>
                  </div>
                </td>
              </tr>
              <tr>
                <td style="font-weight: bold">textEquivalent</td>
                <td>
                  <div title="textEquivalent">Route and send eICR</div>
                </td>
              </tr>
              <tr>
                <td style="font-weight: bold">relatedAction</td>
                <td>
                  <table>
                    <tr>
                      <td style="font-weight: bold">actionId</td>
                      <td>
                        <div title="actionId">validate-eicr</div>
                      </td>
                    </tr>
                    <tr>
                      <td style="font-weight: bold">relationship</td>
                      <td>
                        <div title="relationship">after</div>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </div>
  </text>
  <url value="http://hl7.org/fhir/us/ecr/PlanDefinition/plandefinition-ersd-instance"/>
  <version value="0.1"/>
  <name value="PlanDefinition_eRSD_Instance"/>
  <title value="eRSD PlanDefinition Instance"/>
  <type>
     <coding>
        <system value="http://terminology.hl7.org/CodeSystem/plan-definition-type"/>
        <code value="workflow-definition"/>
        <display value="Workflow Definition"/>
     </coding>
  </type>
  <status value="active"/>
  <date value="2020-07-31T12:32:29.858-05:00"/>
  <effectivePeriod>
     <start value="2020-12-01"/>
  </effectivePeriod>
  <relatedArtifact>
     <type value="depends-on"/>
     <label value="RCTC Value Set Library of Trigger Codes"/>
     <resource value="http://hl7.org/fhir/us/ecr/Library/rctc"/>
  </relatedArtifact>
  <library value="http://aphl.org/fhir/ecr/Library/RuleFilters|1.0.0"/>
  <action id="start">
     <description value="This action represents the start of an encounter."/>
     <textEquivalent value="Start"/>
     <code>
        <coding>
           <system value="http://hl7.org/fhir/us/ecr/CodeSystem/codesystem-executabletask-type"/>
           <code value="start"/>
        </coding>
     </code>
     <trigger>
        <type value="named-event"/>
        <name value="encounter-start"/>
     </trigger>
     <relatedAction>
        <actionId value="check-reportable"/>
        <relationship value="before-start"/>
        <offsetDuration>
           <value value="1"/>
           <code value="h"/>
        </offsetDuration>
     </relatedAction>
  </action>
  <action id="check-reportable">
     <description value="This action represents the check to determine whether an event or situation is suspected reportable."/>
     <textEquivalent value="Check Reportable"/>
     <action>
        <code>
           <coding>
              <system value="http://hl7.org/fhir/us/ecr/CodeSystem/codesystem-executabletask-type"/>
              <code value="check-reportable"/>
           </coding>
        </code>
        <condition>
           <kind value="applicability"/>
           <expression>
              <language value="text/cql.identifier"/>
              <expression value="Is Reportable"/>
           </expression>
        </condition>
        <relatedAction>
           <actionId value="create-and-report-eicr"/>
           <relationship value="before-start"/>
        </relatedAction>
     </action>
     <action>
        <condition>
           <kind value="applicability"/>
           <expression>
              <language value="text/cql.identifier"/>
              <expression value="Is Encounter In Progress"/>
           </expression>
        </condition>
        <relatedAction>
           <actionId value="check-reportable"/>
           <relationship value="before-start"/>
           <offsetDuration>
              <value value="6"/>
              <code value="h"/>
           </offsetDuration>
        </relatedAction>
     </action>
  </action>
  <action id="create-and-report-eicr">
     <description value="This action represents the creation and reporting of an eICR."/>
     <textEquivalent value="Create and Report eICR"/>
     <code>
        <coding>
           <system value="http://hl7.org/fhir/us/ecr/CodeSystem/codesystem-executabletask-type"/>
           <code value="create-and-report-eicr"/>
        </coding>
     </code>
     <action>
        <relatedAction>
           <actionId value="report-eicr"/>
           <relationship value="before-start"/>
        </relatedAction>
     </action>
     <action>
        <condition>
           <kind value="applicability"/>
           <expression>
              <language value="text/cql.identifier"/>
              <expression value="Is Encounter Complete"/>
           </expression>
        </condition>
        <relatedAction>
           <actionId value="report-eicr"/>
           <relationship value="before-start"/>
           <offsetDuration>
              <value value="24"/>
              <code value="h"/>
           </offsetDuration>
        </relatedAction>
     </action>
     <action>
        <condition>
           <kind value="applicability"/>
           <expression>
              <language value="text/cql.identifier"/>
              <expression value="Is Encounter In Progress"/>
           </expression>
        </condition>
        <relatedAction>
           <actionId value="create-and-report-eicr"/>
           <relationship value="before-start"/>
           <offsetDuration>
              <value value="24"/>
              <code value="h"/>
           </offsetDuration>
        </relatedAction>
     </action>
  </action>
  <action id="create-eicr">
     <description value="This action represents the creation of an eICR."/>
     <textEquivalent value="Create eICR."/>
     <code>
        <coding>
           <system value="http://hl7.org/fhir/us/ecr/CodeSystem/codesystem-executabletask-type"/>
           <code value="create-eicr"/>
        </coding>
     </code>
  </action>
  <action id="validate-eicr">
     <description value="This action represents the validation of an eICR."/>
     <textEquivalent value="Validate eICR."/>
     <code>
        <coding>
           <system value="http://hl7.org/fhir/us/ecr/CodeSystem/codesystem-executabletask-type"/>
           <code value="validate-eicr"/>
        </coding>
     </code>
  </action>
  <action id="route-and-send-eicr">
     <description value="This action represents the routing and sending of an eICR."/>
     <textEquivalent value="Route and send eICR"/>
     <code>
        <coding>
           <system value="http://hl7.org/fhir/us/ecr/CodeSystem/codesystem-executabletask-type"/>
           <code value="route-and-send-eicr"/>
        </coding>
     </code>
  </action>
  <action id="report-eicr">
     <description value="This action represents the reporting of an eICR."/>
     <textEquivalent value="Report eICR"/>
     <action>
        <code>
           <coding>
              <system value="http://hl7.org/fhir/us/ecr/CodeSystem/codesystem-executabletask-type"/>
              <code value="report-eicr"/>
           </coding>
        </code>
        <relatedAction>
           <actionId value="create-eicr"/>
           <relationship value="before-start"/>
        </relatedAction>
    </action>
    <action id="close-out-eicr">
        <description value="This action represents the close out of an eICR encounter."/>
        <textEquivalent value="eICR encounter close out (timingTiming.repeat.duration = z hours) - the time after the end of the encounter to create the final eICR when there have been one or more trigger events."/>
        <trigger>
            <type value="data-added"/>
            <data>
                <type value="Encounter"/>
                <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-encounter"/>
                <dateFilter>
                    <path value="period.end"/>
                </dateFilter>
            </data>
        </trigger>
        <relatedAction>
           <actionId value="validate-eicr"/>
           <relationship value="before-start"/>
        </relatedAction>
        <relatedAction>
           <actionId value="route-and-send-eicr"/>
           <relationship value="before-start"/>
        </relatedAction>
     </action>
  </action>
</PlanDefinition>
